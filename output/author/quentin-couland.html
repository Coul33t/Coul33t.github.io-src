<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Quick tutorials - Quentin Couland</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Quick tutorials </a></h1>
                <nav><ul>
                    <li><a href="/category/python.html">Python</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/Graphical-Python-profiling-with-gprof2dot.html">Graphical Python profiling with gprof2dot</a></h1>
<footer class="post-info">
        <abbr class="published" title="2019-04-09T15:00:00+02:00">
                Published: mar. 09 avril 2019
        </abbr>
		<br />
        <abbr class="modified" title="2019-04-09T15:00:00+02:00">
                Updated: mar. 09 avril 2019
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/quentin-couland.html">Quentin Couland</a>
        </address>
<p>In <a href="/category/python.html">Python</a>.</p>
<p>tags: <a href="/tag/python-tutorial-profiling.html">Python Tutorial Profiling</a> </p>
</footer><!-- /.post-info --><p>In this article, I'll talk a bit about Python profiling. If you don't know yet about cProfile, you can check the Python doc <a href="https://docs.python.org/3/library/profile.html#module-cProfile">here</a>. It a very powerful tool, allowing you to check for bottlenecks in your code, time functions, etc. Basically, you run your Python code using the command</p>
<p><code>python -m cProfile -o profiled main.py</code></p>
<p>And then, you'll have an output like this:</p>
<div class="highlight"><pre><span></span>ncalls  tottime  percall  cumtime  percall filename:lineno(function)
6986    0.022    0.000    0.022    0.000 {method &#39;reduce&#39; of &#39;numpy.ufunc&#39; objects}
   3    0.000    0.000    0.000    0.000 {built-in method _socket.inet_aton}
  40    0.000    0.000    0.000    0.000 {method &#39;random_sample&#39; of &#39;mtrand.RandomState&#39; objects}
  40    0.000    0.000    0.000    0.000 {method &#39;randint&#39; of &#39;mtrand.RandomState&#39; objects}
   1    0.000    0.000    0.000    0.000 {built-in method _hashlib.openssl_md5}
   1    0.000    0.000    0.000    0.000 {built-in method _hashlib.openssl_sha1}
   1    0.000    0.000    0.000    0.000 {built-in method _hashlib.openssl_sha224}
   1    0.000    0.000    0.000    0.000 {built-in method _hashlib.openssl_sha256}
   1    0.000    0.000    0.000    0.000 {built-in method _hashlib.openssl_sha384}
   1    0.000    0.000    0.000    0.000 {built-in method _hashlib.openssl_sha512}
   2    0.000    0.000    0.000    0.000 {method &#39;from_buffer&#39; of &#39;_ctypes.PyCArrayType&#39; objects}
  36    0.000    0.000    0.000    0.000 {built-in method _ctypes.POINTER}
   2    0.000    0.000    0.000    0.000 {built-in method _ctypes.pointer}
   1    0.000    0.000    0.000    0.000 {built-in method _ctypes.LoadLibrary}
  36    0.000    0.000    0.000    0.000 {built-in method _ctypes.sizeof}
</pre></div>


<p>You can then order the results, in order to sort by cumulative time, number of calls, etc.</p>
<p>This is a great tool indeed, but it can be a bit hard to read sometimes, even after filtering. I was looking for a graphical visualisation, allowing me to easier track wasted time in my code. I came across <a href="https://github.com/jrfonseca/gprof2dot"><code>gprof2dot</code></a>, which takes a cProfile file as its input, and outputs a configurable graph. Using the default command</p>
<div class="highlight"><pre><span></span>python -m cProfile -o profiled main.py
gprof2dot.exe -f pstats profiled | dot.exe -Tpng -o output.png
</pre></div>


<p>I was able to obtain a nice graph looking like this:
<img alt="Example of an output graph." src="/img/output.svg"></p>
<p>In this case, I'm developping a Roguelike and everytime I moved, there was a delay between the key press and the rendering. Can you find what the problem seems to be? (the answer is at the end of this article) After fixing the problem, the game run at a much more acceptable speed. Here is the second output graph:
<img alt="Output graph after fixing the problem." src="/img/output_2.svg"></p>
<p>Indeed, it is possible to further customise the output graph (I'm not covering this here). This is a very powerful tool, allowing to check the ressources used by (and also to check the workflow of) your program. Oh, and here's the answer to the problem: the rendering function was called 2 times for each update, once by the update function, once by the main loop :)</p>
<p>Cheers!</p>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>